.\" $NetBSD: opensnoop.1m,v 1.2 2020/06/24 18:06:01 sevan Exp $
.Dd June 24, 2020
.Dt OPENSNOOP 1
.Os
.Sh NAME
.Nm opensnoop
.Nd snoop file opens as they occur. Uses DTrace
.Sh SYNOPSIS
.Nm
.Op Fl a | Fl A | Fl ceghsvxZ
.Op Fl f Ar pathname
.Op Fl n Ar name
.Op Fl p Ar PID
.Sh DESCRIPTION
.Nm
tracks file opens.
As a process issues a file open, details such as UID, PID and pathname are
printed out.
The returned file descriptor is printed, a value of -1 indicates an error.
This can be useful for troubleshooting to determine if appliacions are
attempting to open files that do not exist.
Since this uses DTrace, only the root user or users with the
dtrace_kernel privilege can run this command.
.Bl -tag -width Ds
.It Fl a
print all data
.It Fl A
dump all data, space delimited
.It Fl c
print current working directory of process
.It Fl e
print errno value
.It Fl g
print full command arguments
.It Fl s
print start time, us
.It Fl v
print start time, string
.It Fl x
only print failed opens
.It Fl Z
print zonename
.It Fl f Ar pathname
file pathname to snoop
.It Fl n Ar name
process name to snoop
.It Fl p Ar PID
process ID to snoop
.El
.Pp
Description of fields
.Bl -column
.It ZONE
Zone name
.It UID
User ID
.It PID
Process ID
.It PPID
Parent Process ID
.It FD
File Descriptor (-1 is error)
.It ERR
errno value (see
.Pa /usr/include/sys/errno.h
)
.It CWD
current working directory of process
.It PATH
pathname for file open
.It COMM
command name for the process
.It ARGS
argument listing for the process
.It TIME
timestamp for the open event, us
.It STRTIME
timestamp for the open event, string
.El
.Sh EXAMPLES
Default output, print file opens by process as they occur,
.Bd -literal -offset indent
.Ic opensnoop
.Ed
.Pp
Print human readable timestamps,
.Bd -literal -offset indent
.Ic opensnoop -v
.Ed
.Pp
See error codes,
.Bd -literal -offset indent
.Ic opensnoop -e
.Ed
.Pp
Snoop this file only,
.Bd -literal -offset indent
.Ic opensnoop -f /etc/passwd
.Ed
.Sh STABILITY
stable - needs the syscall provider.
.Sh DOCUMENTATION
See the DTraceToolkit for further documentation under the Docs directory.
The DTraceToolkit docs may include full worked examples with verbose
descriptions explaining the output.
.Sh EXIT
opensnoop will run forever until Ctrl\-C is hit.
.Sh SEE ALSO
.Xr dtrace 1
.Sh AUTHORS
.An Brendan Gregg
[Sydney, Australia]
.Sh BUGS
Occasionally the pathname for the file open cannot be read and the following
error will be seen,
.Bd -literal -offset indent
dtrace: error on enabled probe ID 6 (...): invalid address
.Ed
.Pp
this is normal behaviour.
